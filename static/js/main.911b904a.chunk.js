(this["webpackJsonpelection-visualizer"]=this["webpackJsonpelection-visualizer"]||[]).push([[0],{2:function(e,t,a){},20:function(e,t,a){e.exports=a(28)},25:function(e,t,a){},27:function(e,t,a){},28:function(e,t,a){"use strict";a.r(t);var n,r=a(0),c=a.n(r),o=a(15),i=a.n(o),l=(a(25),a(4)),s=a.n(l),u=a(10),d=a(1),m=a(16),v=a.n(m);a(27),a(2);!function(e){e[e.active=0]="active",e[e.elected=1]="elected",e[e.eliminated=2]="eliminated"}(n||(n={}));var f=function(e,t){var a=Math.pow(10,t);return Math.round(e*a)/a},p=function(e){return Array.from(Array(e).keys())};function h(e){var t=e.ballot;return c.a.createElement("div",{className:"Ballot"},c.a.createElement("ul",null,t.votes.map((function(e){return c.a.createElement(c.a.Fragment,null,c.a.createElement("li",{key:e.candidateName,className:"".concat(e.status===n.eliminated?"eliminated":e.status===n.elected?"elected":void 0," animated")},e.candidateName,1!==e.value?"(".concat(f(e.value,3),")"):""),c.a.createElement("br",null))}))))}var E=a(6),b=a(7),g=a(9),O=a(8),y=function(e){Object(g.a)(a,e);var t=Object(O.a)(a);function a(){return Object(E.a)(this,a),t.apply(this,arguments)}return Object(b.a)(a,[{key:"render",value:function(){var e=this.props,t=e.candidate,a=e.expanded,r=t.votesOnLastStage?t.votesOnLastStage:t.votesOnCurrentRound;return a||(r=r.slice(0,1)),c.a.createElement("tr",{key:t.name,className:"".concat(t.status===n.eliminated?"eliminated":t.status===n.elected?"elected":void 0," animated")},c.a.createElement("td",null,t.name),r.map((function(e,t){return c.a.createElement("td",{key:t},f(e,3))})),a&&c.a.createElement("td",{key:"total"},r.reduce((function(e,t){return e+t}),0)))}}]),a}(c.a.Component),N=function(e){Object(g.a)(a,e);var t=Object(O.a)(a);function a(e){var n;return Object(E.a)(this,a),(n=t.call(this,e)).state={expanded:!1},n}return Object(b.a)(a,[{key:"render",value:function(){var e=this,t=this.props.candidates,a=this.state.expanded,n=p(3);return a||(n=n.slice(0,1)),c.a.createElement("div",{className:"candidateTableWrapper"},c.a.createElement("table",{className:"candidateTable"},c.a.createElement("tr",null,c.a.createElement("th",null,"Candidate"),n.map((function(e){return c.a.createElement("th",{key:e},"Rank ".concat(e+1," votes"))})),a&&c.a.createElement("th",null,"Total")),t.map((function(t){return c.a.createElement(y,{key:t.name,candidate:t,expanded:e.state.expanded})}))),c.a.createElement("button",{className:"expandButton",onClick:function(){return e.setState({expanded:!e.state.expanded})}},this.state.expanded?"<":"..."))}}]),a}(c.a.Component);function S(e){var t=e.election,a=Object(r.useState)(0),n=Object(d.a)(a,2),o=n[0],i=n[1];var l=t.phases[o];return c.a.createElement(c.a.Fragment,null,c.a.createElement("div",null,l&&c.a.createElement(N,{candidates:l.candidates})),c.a.createElement("div",{className:"info"},l&&l.info),c.a.createElement("div",null,c.a.createElement("button",{onClick:function(){i(Math.max(0,o-1))},disabled:0===o},"Previous phase"),c.a.createElement("button",{onClick:function(){i(Math.min(t.phases.length-1,o+1))},disabled:o===t.phases.length-1},"Next phase")),c.a.createElement("div",null,t.phases[o]&&t.phases[o].ballots.map((function(e,t){return c.a.createElement(h,{key:t,ballot:e})}))))}var k=a(17);function w(e){var t=e.ballots,a=e.candidates,n=Object(k.cloneDeep)(a).sort((function(e,t){return e.originalOrder-t.originalOrder}));return c.a.createElement("div",{className:"ballotTableWrapper"},c.a.createElement("table",{className:"ballotTable"},c.a.createElement("tr",null,n.map((function(e){return c.a.createElement("th",{key:e.name},e.name)}))),t.map((function(e,t){return c.a.createElement("tr",{key:t},e.map((function(e,t){return c.a.createElement("td",{key:t},null!==e&&void 0!==e?e:"-")})))}))))}function x(e){var t=e.candidate,a=e.expanded;return c.a.createElement("tr",{key:t.name,className:"".concat(t.isElected?"elected":void 0," animated")},c.a.createElement("td",null,t.name),f(t.averageScore,3),a&&t.votesPerScore.map((function(e,t){return c.a.createElement("td",{key:t},e)})),a&&c.a.createElement("td",{key:"noop"},t.noOpVotes))}function j(e){var t=Object(r.useState)(!1),a=Object(d.a)(t,2),n=a[0],o=a[1],i=e.candidates,l=p(5);return c.a.createElement("div",{className:"candidateTableWrapper"},c.a.createElement("table",{className:"candidateTable"},c.a.createElement("tr",null,c.a.createElement("th",null,"Candidate"),c.a.createElement("th",null,"Average score"),n&&l.map((function(e){return c.a.createElement("th",{key:e},"".concat(e+1," \u2b50"))})),n&&c.a.createElement("th",null,"No Opinion")),i.map((function(e){return c.a.createElement(x,{key:e.name,candidate:e,expanded:n})}))),c.a.createElement("button",{className:"expandButton",onClick:function(){return o((function(e){return!e}))}},n?"<":"..."))}function C(e){var t=e.election;return c.a.createElement(c.a.Fragment,null,c.a.createElement("div",null,c.a.createElement(j,{candidates:t.candidates})),c.a.createElement("div",null,c.a.createElement(w,{ballots:t.ballots,candidates:t.candidates})))}function A(e){return c.a.createElement("div",{className:"electionSelector"},c.a.createElement("span",null,c.a.createElement("h3",null,"Elections")),e.elections.map((function(t,a){return c.a.createElement("button",{key:a,onClick:function(){return e.setActiveIndex(a)},disabled:a===e.activeIndex},t.title)})))}var W=[{fileName:"Fall_2021.csv",title:"Fall 2021",system:"score"},{fileName:"Spring_2021.csv",title:"Spring 2021",system:"stv"},{fileName:"Inaugural_Ballot.csv",title:"Fall 2020",system:"stv"}],P=a(19),R=a(11),B=a(18),I=a.n(B);function T(e,t){var a=e.map((function(e){return Object(R.a)(Object(R.a)({},e),{},{votesOnCurrentRound:Array(3).fill(0)})}));return t.forEach((function(e){e.votes.reduce((function(e,t){return a.find((function(e){return e.name===t.candidateName}))?t.status===n.active&&e.push(t):console.error("Something went horribly wrong, trying to assing a vote to candidate ".concat(t.candidateName,", but it was not found on the candidate list")),e}),new Array).forEach((function(e,t){var n=a.find((function(t){return t.name===e.candidateName}));n?n.votesOnCurrentRound[t]+=e.value:console.error("Something went horribly wrong, trying to assing a vote to candidate ".concat(e.candidateName,", but it was not found on the candidate list"))}))})),a.sort((function(e,t){if(void 0!==e.positionWhenElected&&void 0!==t.positionWhenElected)return e.positionWhenElected-t.positionWhenElected;if(void 0!==e.positionWhenElected&&void 0===t.positionWhenElected)return-1;if(void 0===e.positionWhenElected&&void 0!==t.positionWhenElected)return 1;for(var a=0;a<e.votesOnCurrentRound.length;++a){var n=t.votesOnCurrentRound[a]-e.votesOnCurrentRound[a];if(0!==n)return n}return 0})),{newCandidates:a,newBallots:t}}var V=function(e,t){var a=Math.floor(.25*t.length)+1;console.log("Any candidate with ".concat(a," votes or more is automatically elected"));var r=[],c=T(e,t),o=c.newCandidates,i=c.newBallots;r.push({candidates:o,ballots:i,info:"Any candidate with ".concat(a," votes or more is automatically elected")});for(var l=function(){console.log("Phase",r.length,"starting");for(var e=I()(r[r.length-1]),t=!1,c=function(c){var o=e.candidates[c],i=o.votesOnCurrentRound[0];if(o.status!==n.elected&&i>=a){e.candidates[c].status=n.elected,e.candidates[c].votesOnLastStage=o.votesOnCurrentRound,e.candidates[c].positionWhenElected=c,t=!0,console.log("".concat(o.name," elected!"));var l=(i-a)/i;e.ballots.forEach((function(t){var a=!1,r=!1,c=!1;t.votes.forEach((function(t){if(a&&!r){var i=e.candidates.find((function(e){return e.name===t.candidateName}));i&&i.status===n.active&&(t.value=l,r=!0)}t.candidateName===o.name&&(t.status=n.elected,c||(a=!0)),t.candidateName!==o.name&&t.status===n.active&&(c=!0)}))}));var s=T(e.candidates,e.ballots),u=s.newCandidates,d=s.newBallots;r.push({candidates:u,ballots:d,info:"".concat(o.name," had more than ").concat(a," votes, so they were elected!")})}},o=0;o<e.candidates.length&&!t;++o)c(o);if(!t){var i=function(e){for(var t=null,a=e.candidates.length-1;a>=0;--a)if(e.candidates[a].status===n.active){t=e.candidates[a].name,e.candidates[a].status=n.eliminated,e.candidates[a].votesOnLastStage=e.candidates[a].votesOnCurrentRound;break}if(t)return e.ballots.forEach((function(e){e.votes.forEach((function(e){e.candidateName===t&&(e.status=n.eliminated)}))})),t;throw Error("Something went really wrong, no candidate could be eliminated")}(e),l=T(e.candidates,e.ballots),s=l.newCandidates,u=l.newBallots;r.push({candidates:s,ballots:u,info:"".concat(i," had the least votes, so they were eliminated!")})}};r[r.length-1].candidates.filter((function(e){return e.status===n.elected})).length<3;)l();return r};function F(e,t){var a=t.data[0].slice(1).map((function(e){var t=e.match(/\[(.*)\]/),a=(t?t[1]:"").split(" ");return{name:[a[a.length-1]].concat(Object(P.a)(a.slice(0,a.length-1))).join(" "),status:n.active,votesOnCurrentRound:Array(3).fill(0)}})),r=t.data.slice(1).map((function(e){var t=e.slice(1);return{votes:p(3).map((function(e){var r=t.findIndex((function(t){return t.includes(String(e+1))}));return{candidateName:a[r].name,status:n.active,value:1}}))}}));return{title:e,phases:V(a,r)}}function M(e,t){var a=t.data[0].slice(1).map((function(e,t){var a=e.match(/\[(.*)\]/);return{name:a?a[1]:"",votesPerScore:Array(5).fill(0),originalOrder:t,averageScore:0,noOpVotes:0,isElected:!1}})),n=t.data.slice(1).map((function(e){return e.slice(1).map((function(e){var t=e.match(/\((.*)\)/);return t&&Number(t[1])||void 0}))}));return n.forEach((function(e){e.forEach((function(e,t){void 0!==e&&(a[t].votesPerScore[e-1]+=1)}))})),a.forEach((function(e){var t=e.votesPerScore.reduce((function(e,t,a){return e+=t*(a+1)}),0),a=e.votesPerScore.reduce((function(e,t){return e+=t}),0);e.averageScore=t/a,e.noOpVotes=n.length-a})),a.sort((function(e,t){if(e.averageScore!==t.averageScore)return t.averageScore-e.averageScore;if(e.noOpVotes!==t.noOpVotes)return t.noOpVotes-e.noOpVotes;for(var a=4;a<=0;--a)if(e.votesPerScore[a]!==t.votesPerScore[a])return t.votesPerScore[a]-e.votesPerScore[a];return 0})),a.forEach((function(e,t){return e.isElected=t<3})),{title:e,candidates:a,ballots:n}}var L=function(){var e=Object(r.useState)({elections:[]}),t=Object(d.a)(e,2),a=t[0],n=t[1],o=Object(r.useState)(0),i=Object(d.a)(o,2),l=i[0],m=i[1];Object(r.useEffect)((function(){function e(){return(e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:W.forEach(function(){var e=Object(u.a)(s.a.mark((function e(t,r){var c,o,i,l,u,d,m,f;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=t.fileName,o=t.title,i=t.system,e.next=3,fetch("".concat("/election-visualizer","/data/").concat(c));case 3:return l=e.sent,e.next=6,l.text();case 6:u=e.sent,d=v.a.parse(u),"stv"===i?(m=F(o,d),a.elections[r]=m,n({elections:a.elections})):"score"===i&&(f=M(o,d),a.elections[r]=f,n({elections:a.elections}));case 9:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var f=a.elections[l],p=W[l].system;return c.a.createElement("div",{className:"App"},c.a.createElement(A,{elections:a.elections,setActiveIndex:m,activeIndex:l}),f&&("stv"===p?c.a.createElement(S,{election:f}):c.a.createElement(C,{election:f})))};i.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(L,null)),document.getElementById("root"))}},[[20,1,2]]]);
//# sourceMappingURL=main.911b904a.chunk.js.map