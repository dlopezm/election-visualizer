(this["webpackJsonpelection-visualizer"]=this["webpackJsonpelection-visualizer"]||[]).push([[0],{17:function(e,t,n){e.exports=n(27)},22:function(e,t,n){},24:function(e,t,n){},27:function(e,t,n){"use strict";n.r(t);var a,c=n(0),i=n.n(c),r=n(13),o=n.n(r),l=(n(22),n(3)),s=n.n(l),d=n(16),u=n(10),m=n(2),v=n(14),f=n.n(v);n(24),n(9);!function(e){e[e.active=0]="active",e[e.elected=1]="elected",e[e.eliminated=2]="eliminated"}(a||(a={}));var h=function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n},p=function(e){return Array.from(Array(e).keys())};function E(e){var t=e.ballot;return i.a.createElement("div",{className:"Ballot"},i.a.createElement("ul",null,t.votes.map((function(e){return i.a.createElement(i.a.Fragment,null,i.a.createElement("li",{key:e.candidateName,className:"".concat(e.status===a.eliminated?"eliminated":e.status===a.elected?"elected":void 0," animated")},e.candidateName,1!==e.value?"(".concat(h(e.value,3),")"):""),i.a.createElement("br",null))}))))}var b=n(5),g=n(6),O=n(8),y=n(7),w=function(e){Object(O.a)(n,e);var t=Object(y.a)(n);function n(){return Object(b.a)(this,n),t.apply(this,arguments)}return Object(g.a)(n,[{key:"render",value:function(){var e=this.props,t=e.candidate,n=e.expanded,c=t.votesOnLastStage?t.votesOnLastStage:t.votesOnCurrentRound;return n||(c=c.slice(0,1)),i.a.createElement("tr",{key:t.name,className:"".concat(t.status===a.eliminated?"eliminated":t.status===a.elected?"elected":void 0," animated")},i.a.createElement("td",null,t.name),c.map((function(e,t){return i.a.createElement("td",{key:t},h(e,3))})),n&&i.a.createElement("td",{key:"total"},c.reduce((function(e,t){return e+t}),0)))}}]),n}(i.a.Component),N=[{fileName:"Spring_2021.csv",title:"Spring 2021"},{fileName:"Inaugural_Ballot.csv",title:"Fall 2020"}],x=function(e){Object(O.a)(n,e);var t=Object(y.a)(n);function n(e){var a;return Object(b.a)(this,n),(a=t.call(this,e)).state={expanded:!1},a}return Object(g.a)(n,[{key:"render",value:function(){var e=this,t=this.props.candidates,n=this.state.expanded,a=p(3);return n||(a=a.slice(0,1)),i.a.createElement("div",{className:"candidateTableWrapper"},i.a.createElement("table",{className:"candidateTable"},i.a.createElement("tr",null,i.a.createElement("th",null,"Candidate"),a.map((function(e){return i.a.createElement("th",{key:e},"Rank ".concat(e+1," votes"))})),n&&i.a.createElement("th",null,"Total")),t.map((function(t){return i.a.createElement(w,{key:t.name,candidate:t,expanded:e.state.expanded})}))),i.a.createElement("button",{className:"expandButton",onClick:function(){return e.setState({expanded:!e.state.expanded})}},this.state.expanded?"<":"..."))}}]),n}(i.a.Component);function j(e){var t=e.election,n=Object(c.useState)(0),a=Object(m.a)(n,2),r=a[0],o=a[1];var l=t.phases[r];return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",null,l&&i.a.createElement(x,{candidates:l.candidates})),i.a.createElement("div",{className:"info"},l&&l.info),i.a.createElement("div",null,i.a.createElement("button",{onClick:function(){o(Math.max(0,r-1))},disabled:0===r},"Previous phase"),i.a.createElement("button",{onClick:function(){o(Math.min(t.phases.length-1,r+1))},disabled:r===t.phases.length-1},"Next phase")),i.a.createElement("div",null,t.phases[r]&&t.phases[r].ballots.map((function(e,t){return i.a.createElement(E,{key:t,ballot:e})}))))}var k=n(11),C=n(15),S=n.n(C);function R(e,t){var n=e.map((function(e){return Object(k.a)(Object(k.a)({},e),{},{votesOnCurrentRound:Array(3).fill(0)})}));return t.forEach((function(e){e.votes.reduce((function(e,t){return n.find((function(e){return e.name===t.candidateName}))?t.status===a.active&&e.push(t):console.error("Something went horribly wrong, trying to assing a vote to candidate ".concat(t.candidateName,", but it was not found on the candidate list")),e}),new Array).forEach((function(e,t){var a=n.find((function(t){return t.name===e.candidateName}));a?a.votesOnCurrentRound[t]+=e.value:console.error("Something went horribly wrong, trying to assing a vote to candidate ".concat(e.candidateName,", but it was not found on the candidate list"))}))})),n.sort((function(e,t){if(void 0!==e.positionWhenElected&&void 0!==t.positionWhenElected)return e.positionWhenElected-t.positionWhenElected;if(void 0!==e.positionWhenElected&&void 0===t.positionWhenElected)return-1;if(void 0===e.positionWhenElected&&void 0!==t.positionWhenElected)return 1;for(var n=0;n<e.votesOnCurrentRound.length;++n){var a=t.votesOnCurrentRound[n]-e.votesOnCurrentRound[n];if(0!==a)return a}return 0})),{newCandidates:n,newBallots:t}}var A=function(e,t){var n=Math.floor(.25*t.length)+1;console.log("Any candidate with ".concat(n," votes or more is automatically elected"));var c=[],i=R(e,t),r=i.newCandidates,o=i.newBallots;c.push({candidates:r,ballots:o,info:"Any candidate with ".concat(n," votes or more is automatically elected")});for(var l=function(){console.log("Phase",c.length,"starting");for(var e=S()(c[c.length-1]),t=!1,i=function(i){var r=e.candidates[i],o=r.votesOnCurrentRound[0];if(r.status!==a.elected&&o>=n){e.candidates[i].status=a.elected,e.candidates[i].votesOnLastStage=r.votesOnCurrentRound,e.candidates[i].positionWhenElected=i,t=!0,console.log("".concat(r.name," elected!"));var l=(o-n)/o;e.ballots.forEach((function(t){var n=!1,c=!1,i=!1;t.votes.forEach((function(t){if(n&&!c){var o=e.candidates.find((function(e){return e.name===t.candidateName}));o&&o.status===a.active&&(t.value=l,c=!0)}t.candidateName===r.name&&(t.status=a.elected,i||(n=!0)),t.candidateName!==r.name&&t.status===a.active&&(i=!0)}))}));var s=R(e.candidates,e.ballots),d=s.newCandidates,u=s.newBallots;c.push({candidates:d,ballots:u,info:"".concat(r.name," had more than ").concat(n," votes, so they were elected!")})}},r=0;r<e.candidates.length&&!t;++r)i(r);if(!t){var o=function(e){for(var t=null,n=e.candidates.length-1;n>=0;--n)if(e.candidates[n].status===a.active){t=e.candidates[n].name,e.candidates[n].status=a.eliminated,e.candidates[n].votesOnLastStage=e.candidates[n].votesOnCurrentRound;break}if(t)return e.ballots.forEach((function(e){e.votes.forEach((function(e){e.candidateName===t&&(e.status=a.eliminated)}))})),t;throw Error("Something went really wrong, no candidate could be eliminated")}(e),l=R(e.candidates,e.ballots),s=l.newCandidates,d=l.newBallots;c.push({candidates:s,ballots:d,info:"".concat(o," had the least votes, so they were eliminated!")})}};c[c.length-1].candidates.filter((function(e){return e.status===a.elected})).length<3;)l();return c};function W(e){return i.a.createElement("div",{className:"electionSelector"},i.a.createElement("span",null,i.a.createElement("h3",null,"Elections")),e.elections.map((function(t,n){return i.a.createElement("button",{key:n,onClick:function(){return e.setActiveIndex(n)},disabled:n===e.activeIndex},t.title)})))}var B=function(){var e=Object(c.useState)({elections:[]}),t=Object(m.a)(e,2),n=t[0],r=t[1],o=Object(c.useState)(0),l=Object(m.a)(o,2),v=l[0],h=l[1];Object(c.useEffect)((function(){function e(){return(e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:N.forEach(function(){var e=Object(u.a)(s.a.mark((function e(t,c){var i,o,l,u,m,v,h,E,b,g;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.fileName,o=t.title,e.next=3,fetch("".concat("/election-visualizer","/data/").concat(i));case 3:return l=e.sent,e.next=6,l.text();case 6:u=e.sent,m=f.a.parse(u),v=m.data[0].slice(1),h=v.map((function(e){var t=e.match(/\[(.*)\]/),n=(t?t[1]:"").split(" ");return{name:[n[n.length-1]].concat(Object(d.a)(n.slice(0,n.length-1))).join(" "),status:a.active,votesOnCurrentRound:Array(3).fill(0)}})),E=m.data.slice(1),b=E.map((function(e){var t=e.slice(1);return{votes:p(3).map((function(e){var n=t.findIndex((function(t){return t.includes(String(e+1))}));return{candidateName:h[n].name,status:a.active,value:1}}))}})),g=A(h,b),n.elections[c]={title:o,phases:g},r({elections:n.elections});case 15:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var E=n.elections[v];return i.a.createElement("div",{className:"App"},i.a.createElement(W,{elections:n.elections,setActiveIndex:h,activeIndex:v}),E&&i.a.createElement(j,{election:E}))};o.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(B,null)),document.getElementById("root"))},9:function(e,t,n){}},[[17,1,2]]]);
//# sourceMappingURL=main.84d62086.chunk.js.map