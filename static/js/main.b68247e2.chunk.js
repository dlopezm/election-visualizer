(this["webpackJsonpelection-visualizer"]=this["webpackJsonpelection-visualizer"]||[]).push([[0],{2:function(e,t,n){},20:function(e,t,n){e.exports=n(28)},25:function(e,t,n){},27:function(e,t,n){},28:function(e,t,n){"use strict";n.r(t);var a,r=n(0),c=n.n(r),o=n(15),i=n.n(o),l=(n(25),n(4)),s=n.n(l),u=n(10),d=n(1),m=n(16),v=n.n(m);n(27),n(2);!function(e){e[e.active=0]="active",e[e.elected=1]="elected",e[e.eliminated=2]="eliminated"}(a||(a={}));var f=function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n},p=function(e){return Array.from(Array(e).keys())};function h(e){var t=e.ballot;return c.a.createElement("div",{className:"Ballot"},c.a.createElement("ul",null,t.votes.map((function(e){return c.a.createElement(c.a.Fragment,null,c.a.createElement("li",{key:e.candidateName,className:"".concat(e.status===a.eliminated?"eliminated":e.status===a.elected?"elected":void 0," animated")},e.candidateName,1!==e.value?"(".concat(f(e.value,3),")"):""),c.a.createElement("br",null))}))))}var E=n(6),b=n(7),g=n(9),O=n(8),y=function(e){Object(g.a)(n,e);var t=Object(O.a)(n);function n(){return Object(E.a)(this,n),t.apply(this,arguments)}return Object(b.a)(n,[{key:"render",value:function(){var e=this.props,t=e.candidate,n=e.expanded,r=t.votesOnLastStage?t.votesOnLastStage:t.votesOnCurrentRound;return n||(r=r.slice(0,1)),c.a.createElement("tr",{key:t.name,className:"".concat(t.status===a.eliminated?"eliminated":t.status===a.elected?"elected":void 0," animated")},c.a.createElement("td",null,t.name),r.map((function(e,t){return c.a.createElement("td",{key:t},f(e,3))})),n&&c.a.createElement("td",{key:"total"},r.reduce((function(e,t){return e+t}),0)))}}]),n}(c.a.Component),S=function(e){Object(g.a)(n,e);var t=Object(O.a)(n);function n(e){var a;return Object(E.a)(this,n),(a=t.call(this,e)).state={expanded:!1},a}return Object(b.a)(n,[{key:"render",value:function(){var e=this,t=this.props.candidates,n=this.state.expanded,a=p(3);return n||(a=a.slice(0,1)),c.a.createElement("div",{className:"candidateTableWrapper"},c.a.createElement("table",{className:"candidateTable"},c.a.createElement("tr",null,c.a.createElement("th",null,"Candidate"),a.map((function(e){return c.a.createElement("th",{key:e},"Rank ".concat(e+1," votes"))})),n&&c.a.createElement("th",null,"Total")),t.map((function(t){return c.a.createElement(y,{key:t.name,candidate:t,expanded:e.state.expanded})}))),c.a.createElement("button",{className:"expandButton",onClick:function(){return e.setState({expanded:!e.state.expanded})}},this.state.expanded?"<":"..."))}}]),n}(c.a.Component);function N(e){var t=e.election,n=Object(r.useState)(0),a=Object(d.a)(n,2),o=a[0],i=a[1];var l=t.phases[o];return c.a.createElement(c.a.Fragment,null,c.a.createElement("div",null,l&&c.a.createElement(S,{candidates:l.candidates})),c.a.createElement("div",{className:"info"},l&&l.info),c.a.createElement("div",null,c.a.createElement("button",{onClick:function(){i(Math.max(0,o-1))},disabled:0===o},"Previous phase"),c.a.createElement("button",{onClick:function(){i(Math.min(t.phases.length-1,o+1))},disabled:o===t.phases.length-1},"Next phase")),c.a.createElement("div",null,t.phases[o]&&t.phases[o].ballots.map((function(e,t){return c.a.createElement(h,{key:t,ballot:e})}))))}var k=n(17);function w(e){var t=e.ballots,n=e.candidates,a=Object(k.cloneDeep)(n).sort((function(e,t){return e.originalOrder-t.originalOrder}));return c.a.createElement("div",{className:"ballotTableWrapper"},c.a.createElement("table",{className:"ballotTable"},c.a.createElement("tr",null,a.map((function(e){return c.a.createElement("th",{key:e.name},e.name)}))),t.map((function(e,t){return c.a.createElement("tr",{key:t},e.map((function(e,t){return c.a.createElement("td",{key:t},null!==e&&void 0!==e?e:"-")})))}))))}function x(e){var t=e.candidate,n=e.expanded;return c.a.createElement("tr",{key:t.name,className:"".concat(t.isElected?"elected":void 0," animated")},c.a.createElement("td",null,t.name),f(t.averageScore,3),n&&t.votesPerScore.map((function(e,t){return c.a.createElement("td",{key:t},e)})),n&&c.a.createElement("td",{key:"noop"},t.noOpVotes))}function j(e){var t=Object(r.useState)(!1),n=Object(d.a)(t,2),a=n[0],o=n[1],i=e.candidates,l=p(5);return c.a.createElement("div",{className:"candidateTableWrapper"},c.a.createElement("table",{className:"candidateTable"},c.a.createElement("tr",null,c.a.createElement("th",null,"Candidate"),c.a.createElement("th",null,"Average score"),a&&l.map((function(e){return c.a.createElement("th",{key:e},"".concat(e+1," \u2b50"))})),a&&c.a.createElement("th",null,"No Opinion")),i.map((function(e){return c.a.createElement(x,{key:e.name,candidate:e,expanded:a})}))),c.a.createElement("button",{className:"expandButton",onClick:function(){return o((function(e){return!e}))}},a?"<":"..."))}function C(e){var t=e.election;return c.a.createElement(c.a.Fragment,null,c.a.createElement("div",null,c.a.createElement(j,{candidates:t.candidates})),c.a.createElement("div",null,c.a.createElement(w,{ballots:t.ballots,candidates:t.candidates})))}function A(e){return c.a.createElement("div",{className:"electionSelector"},c.a.createElement("span",null,c.a.createElement("h3",null,"Elections")),e.elections.map((function(t,n){return c.a.createElement("button",{key:n,onClick:function(){return e.setActiveIndex(n)},disabled:n===e.activeIndex},t.title)})))}var W=[{fileName:"Spring_2022.csv",title:"Spring 2022",system:"score"},{fileName:"Fall_2021.csv",title:"Fall 2021",system:"score"},{fileName:"Spring_2021.csv",title:"Spring 2021",system:"stv"},{fileName:"Inaugural_Ballot.csv",title:"Fall 2020",system:"stv"}],P=n(19),R=n(11),B=n(18),I=n.n(B);function T(e,t){var n=e.map((function(e){return Object(R.a)(Object(R.a)({},e),{},{votesOnCurrentRound:Array(3).fill(0)})}));return t.forEach((function(e){e.votes.reduce((function(e,t){return n.find((function(e){return e.name===t.candidateName}))?t.status===a.active&&e.push(t):console.error("Something went horribly wrong, trying to assing a vote to candidate ".concat(t.candidateName,", but it was not found on the candidate list")),e}),new Array).forEach((function(e,t){var a=n.find((function(t){return t.name===e.candidateName}));a?a.votesOnCurrentRound[t]+=e.value:console.error("Something went horribly wrong, trying to assing a vote to candidate ".concat(e.candidateName,", but it was not found on the candidate list"))}))})),n.sort((function(e,t){if(void 0!==e.positionWhenElected&&void 0!==t.positionWhenElected)return e.positionWhenElected-t.positionWhenElected;if(void 0!==e.positionWhenElected&&void 0===t.positionWhenElected)return-1;if(void 0===e.positionWhenElected&&void 0!==t.positionWhenElected)return 1;for(var n=0;n<e.votesOnCurrentRound.length;++n){var a=t.votesOnCurrentRound[n]-e.votesOnCurrentRound[n];if(0!==a)return a}return 0})),{newCandidates:n,newBallots:t}}var V=function(e,t){var n=Math.floor(.25*t.length)+1;console.log("Any candidate with ".concat(n," votes or more is automatically elected"));var r=[],c=T(e,t),o=c.newCandidates,i=c.newBallots;r.push({candidates:o,ballots:i,info:"Any candidate with ".concat(n," votes or more is automatically elected")});for(var l=function(){console.log("Phase",r.length,"starting");for(var e=I()(r[r.length-1]),t=!1,c=function(c){var o=e.candidates[c],i=o.votesOnCurrentRound[0];if(o.status!==a.elected&&i>=n){e.candidates[c].status=a.elected,e.candidates[c].votesOnLastStage=o.votesOnCurrentRound,e.candidates[c].positionWhenElected=c,t=!0,console.log("".concat(o.name," elected!"));var l=(i-n)/i;e.ballots.forEach((function(t){var n=!1,r=!1,c=!1;t.votes.forEach((function(t){if(n&&!r){var i=e.candidates.find((function(e){return e.name===t.candidateName}));i&&i.status===a.active&&(t.value=l,r=!0)}t.candidateName===o.name&&(t.status=a.elected,c||(n=!0)),t.candidateName!==o.name&&t.status===a.active&&(c=!0)}))}));var s=T(e.candidates,e.ballots),u=s.newCandidates,d=s.newBallots;r.push({candidates:u,ballots:d,info:"".concat(o.name," had more than ").concat(n," votes, so they were elected!")})}},o=0;o<e.candidates.length&&!t;++o)c(o);if(!t){var i=function(e){for(var t=null,n=e.candidates.length-1;n>=0;--n)if(e.candidates[n].status===a.active){t=e.candidates[n].name,e.candidates[n].status=a.eliminated,e.candidates[n].votesOnLastStage=e.candidates[n].votesOnCurrentRound;break}if(t)return e.ballots.forEach((function(e){e.votes.forEach((function(e){e.candidateName===t&&(e.status=a.eliminated)}))})),t;throw Error("Something went really wrong, no candidate could be eliminated")}(e),l=T(e.candidates,e.ballots),s=l.newCandidates,u=l.newBallots;r.push({candidates:s,ballots:u,info:"".concat(i," had the least votes, so they were eliminated!")})}};r[r.length-1].candidates.filter((function(e){return e.status===a.elected})).length<3;)l();return r};function F(e,t){var n=t.data[0].slice(1).map((function(e){var t=e.match(/\[(.*)\]/),n=(t?t[1]:"").split(" ");return{name:[n[n.length-1]].concat(Object(P.a)(n.slice(0,n.length-1))).join(" "),status:a.active,votesOnCurrentRound:Array(3).fill(0)}})),r=t.data.slice(1).map((function(e){var t=e.slice(1);return{votes:p(3).map((function(e){var r=t.findIndex((function(t){return t.includes(String(e+1))}));return{candidateName:n[r].name,status:a.active,value:1}}))}}));return{title:e,phases:V(n,r)}}function M(e,t){var n=t.data[0].slice(1).map((function(e,t){var n=e.match(/\[(.*)\]/);return{name:n?n[1]:"",votesPerScore:Array(5).fill(0),originalOrder:t,averageScore:0,noOpVotes:0,isElected:!1}})),a=t.data.slice(1).map((function(e){return e.slice(1).map((function(e){var t=e.match(/\((.*)\)/);return t&&Number(t[1])||void 0}))}));return a.forEach((function(e){e.forEach((function(e,t){void 0!==e&&(n[t].votesPerScore[e-1]+=1)}))})),n.forEach((function(e){var t=e.votesPerScore.reduce((function(e,t,n){return e+=t*(n+1)}),0),n=e.votesPerScore.reduce((function(e,t){return e+=t}),0);e.averageScore=t/n,e.noOpVotes=a.length-n})),n.sort((function(e,t){if(e.averageScore!==t.averageScore)return t.averageScore-e.averageScore;if(e.noOpVotes!==t.noOpVotes)return t.noOpVotes-e.noOpVotes;for(var n=4;n<=0;--n)if(e.votesPerScore[n]!==t.votesPerScore[n])return t.votesPerScore[n]-e.votesPerScore[n];return 0})),n.forEach((function(e,t){return e.isElected=t<3})),{title:e,candidates:n,ballots:a}}var L=function(){var e=Object(r.useState)({elections:[]}),t=Object(d.a)(e,2),n=t[0],a=t[1],o=Object(r.useState)(0),i=Object(d.a)(o,2),l=i[0],m=i[1];Object(r.useEffect)((function(){function e(){return(e=Object(u.a)(s.a.mark((function e(){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:W.forEach(function(){var e=Object(u.a)(s.a.mark((function e(t,r){var c,o,i,l,u,d,m,f;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=t.fileName,o=t.title,i=t.system,e.next=3,fetch("".concat("/election-visualizer","/data/").concat(c));case 3:return l=e.sent,e.next=6,l.text();case 6:u=e.sent,d=v.a.parse(u),"stv"===i?(m=F(o,d),n.elections[r]=m,a({elections:n.elections})):"score"===i&&(f=M(o,d),n.elections[r]=f,a({elections:n.elections}));case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var f=n.elections[l],p=W[l].system;return c.a.createElement("div",{className:"App"},c.a.createElement(A,{elections:n.elections,setActiveIndex:m,activeIndex:l}),f&&("stv"===p?c.a.createElement(N,{election:f}):c.a.createElement(C,{election:f})))};i.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(L,null)),document.getElementById("root"))}},[[20,1,2]]]);
//# sourceMappingURL=main.b68247e2.chunk.js.map