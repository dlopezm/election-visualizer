(this["webpackJsonpelection-visualizer"]=this["webpackJsonpelection-visualizer"]||[]).push([[0],{18:function(e,t,a){e.exports=a(28)},23:function(e,t,a){},25:function(e,t,a){},28:function(e,t,a){"use strict";a.r(t);var n,c=a(0),i=a.n(c),r=a(2),s=a.n(r),o=(a(23),a(1)),l=a(10),d=a.n(l),u=a(16),v=a(12),h=a(17),m=a(13),f=a.n(m);a(25),a(9);!function(e){e[e.active=0]="active",e[e.elected=1]="elected",e[e.eliminated=2]="eliminated"}(n||(n={}));var p=function(e,t){var a=Math.pow(10,t);return Math.round(e*a)/a},E=function(e){return Array.from(Array(e).keys())};function b(e){var t=e.ballot;return i.a.createElement("div",{className:"Ballot"},i.a.createElement("ul",null,t.votes.map((function(e){return i.a.createElement(i.a.Fragment,null,i.a.createElement("li",{key:e.candidateName,className:e.status===n.eliminated?"eliminated":e.status===n.elected?"elected":void 0},e.candidateName,1!==e.value?"(".concat(p(e.value,3),")"):""),i.a.createElement("br",null))}))))}var g=a(14),O=a.n(g);function y(e,t){var a=e.map((function(e){return Object(o.a)(Object(o.a)({},e),{},{votesOnCurrentRound:Array(3).fill(0)})}));return t.forEach((function(e){e.votes.reduce((function(e,t){return a.find((function(e){return e.name===t.candidateName}))?t.status===n.active&&e.push(t):console.error("Something went horribly wrong, trying to assing a vote to candidate ".concat(t.candidateName,", but it was not found on the candidate list")),e}),new Array).forEach((function(e,t){var n=a.find((function(t){return t.name===e.candidateName}));n?n.votesOnCurrentRound[t]+=e.value:console.error("Something went horribly wrong, trying to assing a vote to candidate ".concat(e.candidateName,", but it was not found on the candidate list"))}))})),a.sort((function(e,t){if(void 0!==e.positionWhenElected&&void 0!==t.positionWhenElected)return e.positionWhenElected-t.positionWhenElected;if(void 0!==e.positionWhenElected&&void 0===t.positionWhenElected)return-1;if(void 0===e.positionWhenElected&&void 0!==t.positionWhenElected)return 1;for(var a=0;a<e.votesOnCurrentRound.length;++a){var n=t.votesOnCurrentRound[a]-e.votesOnCurrentRound[a];if(0!==n)return n}return 0})),{newCandidates:a,newBallots:t}}var w=function(e,t){var a=Math.ceil(.25*t.length);console.log("Any candidate with ".concat(a," votes or more is automatically elected"));var c={phases:[],activePhase:0},i=y(e,t),r=i.newCandidates,s=i.newBallots;c.phases.push({candidates:r,ballots:s,info:"Any candidate with ".concat(a," votes or more is automatically elected")});for(var o=function(){console.log("Phase",c.phases.length,"starting");for(var e=O()(c.phases[c.phases.length-1]),t=!1,i=function(i){var r=e.candidates[i],s=r.votesOnCurrentRound[0];if(r.status!==n.elected&&s>=a){e.candidates[i].status=n.elected,e.candidates[i].votesOnLastStage=r.votesOnCurrentRound,e.candidates[i].positionWhenElected=i,t=!0,console.log("".concat(r.name," elected!"));var o=(s-a)/s;e.ballots.forEach((function(t){var a=!1,c=!1;t.votes.forEach((function(t){if(a&&!c){var i=e.candidates.find((function(e){return e.name===t.candidateName}));i&&i.status===n.active&&(t.value=o,c=!0)}t.candidateName===r.name&&(t.status=n.elected,a=!0)}))}));var l=y(e.candidates,e.ballots),d=l.newCandidates,u=l.newBallots;c.phases.push({candidates:d,ballots:u,info:"".concat(r.name," had more than ").concat(a," votes, so they were elected!")})}},r=0;r<e.candidates.length&&!t;++r)i(r);if(!t){var s=function(e){for(var t=null,a=e.candidates.length-1;a>=0;--a)if(e.candidates[a].status===n.active){t=e.candidates[a].name,e.candidates[a].status=n.eliminated,e.candidates[a].votesOnLastStage=e.candidates[a].votesOnCurrentRound;break}if(t)return e.ballots.forEach((function(e){e.votes.forEach((function(e){e.candidateName===t&&(e.status=n.eliminated)}))})),t;throw Error("Something went really wrong, no candidate could be eliminated")}(e),o=y(e.candidates,e.ballots),l=o.newCandidates,d=o.newBallots;c.phases.push({candidates:l,ballots:d,info:"".concat(s," had the least votes, so they were eliminated!")})}};c.phases[c.phases.length-1].candidates.filter((function(e){return e.status===n.elected})).length<3;)o();return c},j=a(5),C=a(6),N=a(8),k=a(7),x=a(15),P=function(e){Object(N.a)(a,e);var t=Object(k.a)(a);function a(){return Object(j.a)(this,a),t.apply(this,arguments)}return Object(C.a)(a,[{key:"render",value:function(){var e=this.props,t=e.candidate,a=e.expanded,c=t.votesOnLastStage?t.votesOnLastStage:t.votesOnCurrentRound;return a||(c=c.slice(0,1)),i.a.createElement("tr",{key:t.name,className:t.status===n.eliminated?"eliminated":t.status===n.elected?"elected":void 0},i.a.createElement("td",null,t.name),c.map((function(e,t){return i.a.createElement("td",{key:t},p(e,3))})),a&&i.a.createElement("td",{key:"total"},c.reduce((function(e,t){return e+t}),0)))}}]),a}(i.a.Component),R=function(e){Object(N.a)(a,e);var t=Object(k.a)(a);function a(e){var n;return Object(j.a)(this,a),(n=t.call(this,e)).state={expanded:!1},n}return Object(C.a)(a,[{key:"render",value:function(){var e=this,t=this.props.candidates,a=this.state.expanded,n=E(3);return a||(n=n.slice(0,1)),i.a.createElement("div",{className:"candidateTableWrapper"},i.a.createElement("table",{className:"candidateTable"},i.a.createElement(x.a,null,i.a.createElement("tr",null,i.a.createElement("th",null,"Candidate"),n.map((function(e){return i.a.createElement("th",{key:e},"Rank ".concat(e+1," votes"))})),a&&i.a.createElement("th",null,"Total")),t.map((function(t){return i.a.createElement(P,{key:t.name,candidate:t,expanded:e.state.expanded})})))),i.a.createElement("button",{className:"expandButton",onClick:function(){return e.setState({expanded:!e.state.expanded})}},this.state.expanded?"<":">"))}}]),a}(i.a.Component);var S=function(){var e=Object(c.useState)({phases:[],activePhase:0}),t=Object(h.a)(e,2),a=t[0],r=t[1];Object(c.useEffect)((function(){function e(){return(e=Object(v.a)(d.a.mark((function e(){var t,a,c,i,s,o,l,v;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat("/election-visualizer","/data/Inaugural_Ballot.csv"));case 2:return t=e.sent,e.next=5,t.text();case 5:a=e.sent,c=f.a.parse(a),i=c.data[0].slice(1),s=i.map((function(e){var t=e.match(/\[(.*)\]/),a=(t?t[1]:"").split(" ");return{name:[a[a.length-1]].concat(Object(u.a)(a.slice(0,a.length-1))).join(" "),status:n.active,votesOnCurrentRound:Array(3).fill(0)}})),o=c.data.slice(1),l=o.map((function(e){var t=e.slice(1);return{votes:E(3).map((function(e){var a=t.findIndex((function(t){return t.includes(String(e+1))}));return{candidateName:s[a].name,status:n.active,value:1}}))}})),v=w(s,l),r(v);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[]);var s=a.phases[a.activePhase];return i.a.createElement("div",{className:"App"},i.a.createElement("div",null,s&&i.a.createElement(i.a.Fragment,null,i.a.createElement(R,{candidates:s.candidates}))),i.a.createElement("div",{className:"info"},s&&s.info),i.a.createElement("div",null,i.a.createElement("button",{onClick:function(){r(Object(o.a)(Object(o.a)({},a),{},{activePhase:Math.max(0,a.activePhase-1)}))},disabled:0===a.activePhase},"Previous phase"),i.a.createElement("button",{onClick:function(){r(Object(o.a)(Object(o.a)({},a),{},{activePhase:Math.min(a.phases.length-1,a.activePhase+1)}))},disabled:a.activePhase===a.phases.length-1},"Next phase")),i.a.createElement("div",null,a.phases[a.activePhase]&&a.phases[a.activePhase].ballots.map((function(e,t){return i.a.createElement(b,{key:t,ballot:e})}))))};s.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(S,null)),document.getElementById("root"))},9:function(e,t,a){}},[[18,1,2]]]);
//# sourceMappingURL=main.dd81d2e1.chunk.js.map